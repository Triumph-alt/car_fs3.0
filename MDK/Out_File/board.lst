<<<<<<< Updated upstream
C251 COMPILER V5.60.0,  board                                                              10/07/25  23:18:27  PAGE 1   
=======
C251 COMPILER V5.60.0,  board                                                              10/07/25  11:51:20  PAGE 1   
>>>>>>> Stashed changes


C251 COMPILER V5.60.0, COMPILATION OF MODULE board
OBJECT MODULE PLACED IN .\Out_File\board.obj
COMPILER INVOKED BY: D:\Software\Keil5\c251v560\C251\BIN\C251.EXE ..\libraries\board.c LARGE INTR2 WARNINGLEVEL(3) OPTIM
                    -IZE(0,SPEED) BROWSE INCDIR(..\USER\inc;..\USER\src;..\libraries;..\seekfree_libraries;..\seekfree_peripheral) DEBUG PRIN
                    -T(.\Out_File\board.lst) OBJECT(.\Out_File\board.obj) 

stmt  level    source

    1          /********************************************************************************************************
             -*************
    2           * COPYRIGHT NOTICE
    3           * Copyright (c) 2020,é€é£ç§‘æŠ€
    4           * All rights reserved.
    5           * æŠ€æœ¯è®¨è®ºQQç¾¤ï¼šä¸€ç¾¤ï¼š179029047(å·²æ»¡)  äºŒç¾¤ï¼š244861897(å·²æ»¡)  ä¸‰ç¾¤ï¼š824575535
    6           *
    7           * ä»¥ä¸‹æ‰€æœ‰å†…å®¹ç‰ˆæƒå‡å±é€é£ç§‘æŠ€æ‰€æœ‰ï¼Œæœªç»å…è®¸ä¸å¾—ç”¨äºå•†ä¸šç”¨é€”ï¼Œ
    8           * æ¬¢è¿å„ä½ä½¿ç”¨å¹¶ä¼ æ’­æœ¬ç¨‹åºï¼Œä¿®æ”¹å†…å®¹æ—¶å¿…é¡»ä¿ç•™é€é£ç§‘æŠ€çš„ç‰ˆæƒå£°æ˜ã€‚
    9           *
   10           * @file                board
   11           * @company                     æˆéƒ½é€é£ç§‘æŠ€æœ‰é™å…¬å¸
   12           * @author              é€é£ç§‘æŠ€(QQ790875685)
   13           * @version             æŸ¥çœ‹docå†…versionæ–‡ä»¶ ç‰ˆæœ¬è¯´æ˜
   14           * @Software            MDK FOR C251 V5.60
   15           * @Target core         STC32G12K128
   16           * @Taobao              https://seekfree.taobao.com/
   17           * @date                2020-4-14
   18           ********************************************************************************************************
             -************/
   19           
   20           
   21          #include "board.h"
   22          #include "zf_uart.h"
   23          #include "zf_tim.h"
   24          #include "zf_delay.h"
   25          
   26          //22.11MHzçš„IRCå‚æ•°å¯„å­˜å™¨ 0xFB
   27          //24MHzçš„IRCå‚æ•°å¯„å­˜å™¨ 0xFB
   28          #define IRC_22M (*((uint8  idata*)0xFA))
   29          #define IRC_24M (*((uint8  idata*)0xFB))
   30          
   31          
   32          //å†…æ ¸é¢‘ç‡
   33          int32 sys_clk = FOSC;
   34          
   35          
   36          
   37          //-------------------------------------------------------------------------------------------------------
             -------------
   38          //  @brief      STC32Gè®¾ç½®ç³»ç»Ÿé¢‘ç‡
   39          //  @param      NULL            ç©ºå€¼
   40          //  @return     void            ç³»ç»Ÿé¢‘ç‡
   41          //  Sample usage:               
   42          //-------------------------------------------------------------------------------------------------------
             -------------
   43          uint32 set_clk(void)
   44          {
   45   1              
   46   1              P_SW2 |= 0x80;
   47   1      
   48   1              if(sys_clk == 22118400)
   49   1              {
   50   2                      //é€‰æ‹© 22.1184MHz
   51   2                      CLKDIV = 0x04;
   52   2                      IRTRIM = T22M_ADDR;
   53   2                      VRTRIM = VRT27M_ADDR;
<<<<<<< Updated upstream
C251 COMPILER V5.60.0,  board                                                              10/07/25  23:18:27  PAGE 2   
=======
C251 COMPILER V5.60.0,  board                                                              10/07/25  11:51:20  PAGE 2   
>>>>>>> Stashed changes

   54   2                      IRCBAND = 0x02;
   55   2                      CLKDIV = 0x00;
   56   2              }
   57   1              else if(sys_clk == 24000000)
   58   1              {
   59   2                      //é€‰æ‹© 24MHz
   60   2                      CLKDIV = 0x04;
   61   2                      IRTRIM = T24M_ADDR;
   62   2                      VRTRIM = VRT27M_ADDR;
   63   2                      IRCBAND = 0x02;
   64   2                      CLKDIV = 0x00;
   65   2              }
   66   1              else if(sys_clk == 27000000)
   67   1              {
   68   2                      //é€‰æ‹© 27MHz
   69   2                      CLKDIV = 0x04;
   70   2                      IRTRIM = T27M_ADDR;
   71   2                      VRTRIM = VRT27M_ADDR;
   72   2                      IRCBAND = 0x02;
   73   2                      CLKDIV = 0x00;
   74   2              }
   75   1              else if(sys_clk == 30000000)
   76   1              {
   77   2              
   78   2                      //é€‰æ‹© 30MHz
   79   2                      CLKDIV = 0x04;
   80   2                      IRTRIM = T30M_ADDR;
   81   2                      VRTRIM = VRT27M_ADDR;
   82   2                      IRCBAND = 0x02;
   83   2                      CLKDIV = 0x00;
   84   2              }
   85   1              else if(sys_clk == 33177600)
   86   1              {
   87   2                      //é€‰æ‹© 33.1776MHz
   88   2                      CLKDIV = 0x04;
   89   2                      IRTRIM = T33M_ADDR;
   90   2                      VRTRIM = VRT27M_ADDR;
   91   2                      IRCBAND = 0x02;
   92   2                      CLKDIV = 0x00;
   93   2              }
   94   1              else if(sys_clk == 35000000)
   95   1              {
   96   2                      //é€‰æ‹© 35MHz
   97   2                      CLKDIV = 0x04;
   98   2                      IRTRIM = T35M_ADDR;
   99   2                      VRTRIM = VRT44M_ADDR;
  100   2                      IRCBAND = 0x03;
  101   2                      CLKDIV = 0x00;
  102   2              }
  103   1              else
  104   1              {
  105   2                      sys_clk = 33177600;
  106   2                      //é€‰æ‹© 33.1776MHz
  107   2                      CLKDIV = 0x04;
  108   2                      IRTRIM = T33M_ADDR;
  109   2                      VRTRIM = VRT27M_ADDR;
  110   2                      IRCBAND = 0x02;
  111   2                      CLKDIV = 0x00;
  112   2              }
  113   1      
  114   1              return sys_clk;
  115   1      }
  116          
  117          
  118          
  119          
<<<<<<< Updated upstream
C251 COMPILER V5.60.0,  board                                                              10/07/25  23:18:27  PAGE 3   
=======
C251 COMPILER V5.60.0,  board                                                              10/07/25  11:51:20  PAGE 3   
>>>>>>> Stashed changes

  120          
  121          void board_init(void)
  122          {
  123   1              EAXFR = 1;                              // ä½¿èƒ½è®¿é—®XFR
  124   1              CKCON = 0x00;                   // è®¾ç½®å¤–éƒ¨æ•°æ®æ€»çº¿ä¸ºæœ€å¿«
  125   1              WTST = 0;               // è®¾ç½®ç¨‹åºä»£ç ç­‰å¾…å‚æ•°ï¼Œèµ‹å€¼ä¸º0å¯å°†CPUæ‰§è¡Œç¨‹åºçš„é€Ÿåº¦è®¾ç
             -½®ä¸ºæœ€å¿«
  126   1              SET_P54_RESRT;                  // ä½¿P54ä¸ºå¤ä½å¼•è„š
  127   1              P_SW2 = 0x80;                   // å¼€å¯ç‰¹æ®Šåœ°å€è®¿é—®
  128   1      
  129   1      #if (1 == EXTERNAL_CRYSTA_ENABLE)
                       XOSCCR = 0xc0;                  //å¯åŠ¨å¤–éƒ¨æ™¶æŒ¯
                       while (!(XOSCCR & 1));  //ç­‰å¾…æ—¶é’Ÿç¨³å®š
                       CLKDIV = 0x00;                  //æ—¶é’Ÿä¸åˆ†é¢‘
                       CLKSEL = 0x01;                  //é€‰æ‹©å¤–éƒ¨æ™¶æŒ¯
               #else
  135   1              //è‡ªåŠ¨è®¾ç½®ç³»ç»Ÿé¢‘ç‡
  136   1              #if (0 == FOSC)
  137   1                      sys_clk = set_clk();
  138   1              #else
                               sys_clk = FOSC;
                       #endif
  141   1      #endif
  142   1      
  143   1              delay_init();                   //å»¶æ—¶å‡½æ•°åˆå§‹åŒ–
  144   1              
  145   1              WTST = 0;
  146   1          P_SW2 |= 0x80;
  147   1          CLKDIV = 0;                         //24MHzä¸»é¢‘ï¼Œåˆ†é¢‘è®¾ç½®
  148   1              
  149   1              P0M0 = 0x00;
  150   1              P0M1 = 0x00;
  151   1              P1M0 = 0x00;
  152   1              P1M1 = 0x00;
  153   1              P2M0 = 0x00;
  154   1              P2M1 = 0x00;
  155   1              P3M0 = 0x00;
  156   1              P3M1 = 0x00;
  157   1              P4M0 = 0x00;
  158   1              P4M1 = 0x00;
  159   1              P5M0 = 0x00;
  160   1              P5M1 = 0x00;
  161   1              P6M0 = 0x00;
  162   1              P6M1 = 0x00;
  163   1              P7M0 = 0x00;
  164   1              P7M1 = 0x00;
  165   1              
  166   1              ADCCFG = 0;
  167   1              AUXR = 0;
  168   1              SCON = 0;
  169   1              S2CON = 0;
  170   1              S3CON = 0;
  171   1              S4CON = 0;
  172   1              P_SW1 = 0;
  173   1              IE2 = 0;
  174   1              TMOD = 0;
  175   1      
  176   1      //      uart_init(DEBUG_UART, DEBUG_UART_RX_PIN, DEBUG_UART_TX_PIN, DEBUG_UART_BAUD, DEBUG_UART_TIM);
  177   1              EnableGlobalIRQ();
  178   1      }
  179          
  180          
  181          //#if (1 == PRINTF_ENABLE)      //åˆå§‹åŒ–è°ƒè¯•ä¸²å£
  182          ////é‡å®šä¹‰printf æ•°å­— åªèƒ½è¾“å‡ºuint16
  183          //char putchar(char c)
  184          //{
<<<<<<< Updated upstream
C251 COMPILER V5.60.0,  board                                                              10/07/25  23:18:27  PAGE 4   
=======
C251 COMPILER V5.60.0,  board                                                              10/07/25  11:51:20  PAGE 4   
>>>>>>> Stashed changes

  185          //      uart_putchar(DEBUG_UART, c);//æŠŠè‡ªå·±å®ç°çš„ä¸²å£æ‰“å°ä¸€å­—èŠ‚æ•°æ®çš„å‡½æ•°æ›¿æ¢åˆ°è¿™é‡Œ
  186          
  187          //      return c;
  188          //}
  189          //#endif
  190          
  191          
  192          void DisableGlobalIRQ(void)
  193          {
  194   1              EA = 0;
  195   1      }
  196          
  197          
  198          void EnableGlobalIRQ(void)
  199          {
  200   1              EA = 1;
  201   1      }
  202          


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       704     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =         4     ------
  xdata-const size     =    ------     ------
  edata size           =    ------     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =         9     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
