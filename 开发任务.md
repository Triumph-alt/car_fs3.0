# 开发任务进度

| 编号 | 任务描述 | 状态 |
| ---- | -------- | ---- |
| 1 | ELECT_PARA 状态下显示 max_value 数组到 OLED | ✅ 已完成 |
| 2 | PID_PARA 状态下显示 SpeedPID / TurnPID 的 Kp、Ki、Kd (浮点两位小数) | ✅ 已完成 | 
| 3 | 按键交互功能 - 添加选择项目变量和标记显示 | ✅ 已完成 |
| 4 | 按键交互功能 - 实现按键1作为选择键，轮询选择参数项 | ✅ 已完成 |
| 5 | 按键交互功能 - 实现按键2和按键3作为加减键，调整参数值 | ✅ 已完成 |
| 6 | 优化功能 - 添加参数保存到Flash功能 | 🔄 待实现 |
| 7 | 优化功能 - 添加参数步长调整功能（长按/短按区分） | 🔄 待实现 |
| 9 | DMA-ADC - 重构归一化函数，直接使用DMA平均值 | 🔄 待实现 |
| 10 | DMA-ADC - 简化滤波函数，移除多余中间变量 | 🔄 待实现 |
| 11 | DMA-ADC - 优化位置计算算法，适配新数据格式 | 🔄 待实现 |
| 12 | DMA-ADC - 测试新系统的数据准确性和性能提升 | 🔄 待实现 |
| 13 | DMA-ADC - 实现average_filter函数，从DMA缓冲区读取ADC平均值 | ✅ 已完成 |
| 14 | DMA-ADC - 在average_filter中实现递推均值滤波算法 | ✅ 已完成 |
| 15 | DMA-ADC - 优化average_filter中的DMA数据读取逻辑 | ✅ 已完成 |
| 16 | DMA-ADC - 测试average_filter性能和数据稳定性 | 🔄 进行中 |
| 17 | DMA-ADC - 修改main循环，在DmaADCFlag处理中调用数据处理流程 | ✅ 已完成 |
| 18 | DMA-ADC - 解决循环采集中的同步问题，消除数据处理延迟 | 🔄 进行中 |

## 按键功能说明

1. **按键0**: 切换状态（ELECT_PARA -> PID_PARA -> CHARGE -> RUNNING）
2. **按键1**: 选择当前页面的参数项
   - ELECT_PARA状态：在7个max_value数组项之间切换
   - PID_PARA状态：在6个PID参数之间切换
3. **按键2**: 增加当前选中的参数值
   - ELECT_PARA状态：每次增加10
   - PID_PARA状态：每次增加0.1
4. **按键3**: 减少当前选中的参数值
   - ELECT_PARA状态：每次减少10（最小为0）
   - PID_PARA状态：每次减少0.1（最小为0）

## 界面显示说明

1. **ELECT_PARA状态**：显示7个电感的max_value值，当前选中项前有">"标记
2. **PID_PARA状态**：显示速度和转向PID参数，当前选中项前有">"标记

## DMA-ADC 功能改进说明

1. **优势**：
   - 硬件自动多次采样并计算平均值，提高数据稳定性
   - 降低CPU负载，无需CPU参与每次采样和滤波过程
   - 简化软件架构，减少中间变量和复杂滤波算法

2. **实现方向**：
   - 使用DMA缓冲区中计算好的平均值，替代软件滤波
   - 简化数据处理流程，提高系统响应速度
   - 保持关键算法接口不变，确保系统兼容性 

3. **改进成果**：
   - 实现了基于DMA的average_filter函数，完成递推均值滤波
   - 优化了数据采集流程，实现"一次性"读取7通道数据
   - 在主循环中集成了完整的数据处理流程
   - 通过电感通道映射表解决了DMA通道与传感器位置的对应关系 